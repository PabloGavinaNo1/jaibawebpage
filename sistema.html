<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JaibaManager | Sistema Integral</title>
    <style>
        /* --- ESTILOS VISUALES --- */
        :root {
            --jaiba-blue: #00A8E8; 
            --deep-ocean: #003459; 
            --white: #ffffff;
            --danger: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --light: #f1f5f9;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--light); color: var(--deep-ocean); padding-bottom: 50px; }

        /* HEADER */
        header {
            background-color: var(--white); padding: 15px 40px; display: flex;
            justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 100;
        }
        .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.5rem; }
        .brand img { height: 40px; }
        .brand span { color: var(--jaiba-blue); }
        .btn-logout { text-decoration: none; color: var(--danger); font-weight: bold; border: 1px solid var(--danger); padding: 5px 15px; border-radius: 20px; transition: 0.3s; }
        .btn-logout:hover { background: var(--danger); color: white; }

        /* LAYOUT DASHBOARD */
        .dashboard {
            max-width: 1200px; margin: 30px auto; padding: 0 20px;
            display: grid; 
            grid-template-columns: 1fr 1fr; /* Dividido en 2 columnas */
            gap: 25px;
        }

        /* CARD GENERAL */
        .card { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h2 { margin-bottom: 20px; color: var(--deep-ocean); font-size: 1.2rem; border-bottom: 2px solid var(--light); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        /* FORMULARIOS */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; outline: none; background: #fff; }
        input:focus, select:focus { border-color: var(--jaiba-blue); }

        /* BOTONES */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-primary { background-color: var(--jaiba-blue); color: white; }
        .btn-primary:hover { background-color: var(--deep-ocean); }
        .btn-success { background-color: var(--success); color: white; font-size: 1.1rem; }
        .btn-success:hover { background-color: #16a34a; }
        .btn-add-cart { background-color: var(--deep-ocean); color: white; margin-top: 10px; }

        /* TABLAS */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th { text-align: left; padding: 10px; color: var(--text-grey); border-bottom: 2px solid var(--light); }
        td { padding: 10px; border-bottom: 1px solid var(--light); }
        
        /* STOCK BADGES */
        .stock-badge { padding: 3px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
        .in-stock { background-color: #dcfce7; color: var(--success); }
        .low-stock { background-color: #fee2e2; color: var(--danger); }

        /* POS SECTION SPECIFIC */
        .pos-area { grid-column: 1 / -1; } /* POS ocupa todo el ancho arriba */
        .cart-total { text-align: right; font-size: 1.5rem; font-weight: 800; margin: 20px 0; color: var(--deep-ocean); }

        /* ACCIONES */
        .actions button { border: none; background: none; cursor: pointer; font-size: 1.1rem; margin-right: 5px; transition: 0.2s; }
        .actions button:hover { transform: scale(1.2); }

        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <img src="logo.png" alt="Logo">
            Jaiba<span>Manager</span>
        </div>
        <a href="index.html" class="btn-logout">Cerrar Sesi√≥n</a>
    </header>

    <div class="dashboard">
        
        <div class="card pos-area">
            <h2>üõí Terminal de Venta <span style="font-size:0.9rem; opacity:0.6;">Modo Cajero</span></h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <div class="form-group">
                        <label>Seleccionar Producto</label>
                        <select id="pos-product-select">
                            <option value="">-- Elige un producto --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Cantidad</label>
                        <input type="number" id="pos-qty" value="1" min="1">
                    </div>
                    <button class="btn btn-add-cart" onclick="addToCart()">‚¨áÔ∏è Agregar al Carrito</button>
                </div>

                <div style="background: #f8fafc; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0;">
                    <h3 style="margin-bottom: 10px;">Ticket Actual</h3>
                    <ul id="cart-list" style="list-style: none; margin-bottom: 15px; max-height: 150px; overflow-y: auto;">
                        <li style="opacity: 0.6; font-style: italic;">El carrito est√° vac√≠o...</li>
                    </ul>
                    <hr>
                    <div class="cart-total">Total: $<span id="cart-total-display">0.00</span></div>
                    <button class="btn btn-success" onclick="processSale()">‚úÖ Cobrar y Descontar Stock</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üì¶ Gesti√≥n de Inventario</h2>
            <form id="product-form">
                <input type="hidden" id="product-index">
                <div class="form-group">
                    <label>Nombre del Platillo/Insumo</label>
                    <input type="text" id="nombre" placeholder="Ej. Hamburguesa Especial" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                        <label>Precio ($)</label>
                        <input type="number" id="precio" placeholder="0.00" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Stock Inicial</label>
                        <input type="number" id="stock" placeholder="0" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="btn-action">Guardar en Base de Datos</button>
            </form>
        </div>

        <div class="card">
            <h2>üìä Existencias en Tiempo Real</h2>
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>$ Venta</th>
                        <th>Stock</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="inventory-list">
                    </tbody>
            </table>
            <p id="empty-msg" style="text-align: center; margin-top: 20px; opacity: 0.5;">Inventario vac√≠o.</p>
        </div>

    </div>

    <script>
        // --- 1. DATOS ---
        let products = [];
        let cart = []; // Carrito temporal

        // Elementos del DOM
        const form = document.getElementById('product-form');
        const list = document.getElementById('inventory-list');
        const posSelect = document.getElementById('pos-product-select');
        const cartList = document.getElementById('cart-list');
        const totalDisplay = document.getElementById('cart-total-display');
        let editIndex = -1;

        // --- 2. INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            const stored = localStorage.getItem('jaiba_inventory');
            if(stored) products = JSON.parse(stored);
            renderAll();
        });

        // --- 3. FUNCIONES DE RENDERIZADO (ACTUALIZAR PANTALLA) ---
        function renderAll() {
            renderTable();
            updatePosDropdown();
        }

        function renderTable() {
            list.innerHTML = '';
            if(products.length === 0) {
                document.getElementById('empty-msg').style.display = 'block';
            } else {
                document.getElementById('empty-msg').style.display = 'none';
                products.forEach((prod, index) => {
                    const stockClass = prod.stock < 5 ? 'low-stock' : 'in-stock';
                    const row = `
                        <tr>
                            <td><b>${prod.nombre}</b></td>
                            <td>$${parseFloat(prod.precio).toFixed(2)}</td>
                            <td><span class="stock-badge ${stockClass}">${prod.stock} un.</span></td>
                            <td class="actions">
                                <button onclick="editProduct(${index})">‚úèÔ∏è</button>
                                <button onclick="deleteProduct(${index})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                    list.innerHTML += row;
                });
            }
        }

        function updatePosDropdown() {
            posSelect.innerHTML = '<option value="">-- Elige un producto --</option>';
            products.forEach((prod, index) => {
                // Solo mostramos si hay stock > 0
                if(prod.stock > 0) {
                    posSelect.innerHTML += `<option value="${index}">${prod.nombre} - $${prod.precio} (Disp: ${prod.stock})</option>`;
                }
            });
        }

        // --- 4. GESTI√ìN DE PRODUCTOS (CRUD) ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const newProd = {
                nombre: document.getElementById('nombre').value,
                precio: parseFloat(document.getElementById('precio').value),
                stock: parseInt(document.getElementById('stock').value)
            };

            if(editIndex === -1) products.push(newProd);
            else {
                products[editIndex] = newProd;
                editIndex = -1;
                document.getElementById('btn-action').innerText = "Guardar en Base de Datos";
                document.getElementById('btn-action').classList.remove('btn-success');
                document.getElementById('btn-action').classList.add('btn-primary');
            }

            saveLocal();
            renderAll();
            form.reset();
        });

        window.deleteProduct = (i) => {
            if(confirm('¬øBorrar este producto?')) {
                products.splice(i, 1);
                saveLocal();
                renderAll();
            }
        }

        window.editProduct = (i) => {
            const p = products[i];
            document.getElementById('nombre').value = p.nombre;
            document.getElementById('precio').value = p.precio;
            document.getElementById('stock').value = p.stock;
            editIndex = i;
            document.getElementById('btn-action').innerText = "Actualizar Producto";
        }

        // --- 5. L√ìGICA DE PUNTO DE VENTA (POS) ---
        
        window.addToCart = () => {
            const index = posSelect.value;
            const qty = parseInt(document.getElementById('pos-qty').value);

            if(index === "") { alert("Selecciona un producto"); return; }
            
            const prod = products[index];

            // Validaci√≥n de Stock
            if(prod.stock < qty) {
                alert(`Error: Solo tienes ${prod.stock} unidades de ${prod.nombre}`);
                return;
            }

            // Agregar al carrito
            const subtotal = prod.precio * qty;
            cart.push({ index: index, name: prod.nombre, qty: qty, price: subtotal });
            
            renderCart();
        };

        function renderCart() {
            cartList.innerHTML = '';
            let total = 0;
            
            if(cart.length === 0) {
                cartList.innerHTML = '<li style="opacity: 0.6; font-style: italic;">El carrito est√° vac√≠o...</li>';
            } else {
                cart.forEach((item, i) => {
                    total += item.price;
                    cartList.innerHTML += `
                        <li style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px dashed #eee;">
                            <span>${item.qty}x ${item.name}</span>
                            <b>$${item.price.toFixed(2)}</b>
                            <span style="cursor:pointer; color:red;" onclick="removeFromCart(${i})">√ó</span>
                        </li>
                    `;
                });
            }
            totalDisplay.innerText = total.toFixed(2);
        }

        window.removeFromCart = (i) => {
            cart.splice(i, 1);
            renderCart();
        }

        window.processSale = () => {
            if(cart.length === 0) { alert("El carrito est√° vac√≠o"); return; }

            // DESCONTAR STOCK REAL
            cart.forEach(item => {
                // item.index es el √≠ndice en el array original de productos
                products[item.index].stock -= item.qty;
            });

            // Guardar cambios
            saveLocal();
            
            // Limpiar y Feedback
            cart = [];
            renderCart();
            renderAll(); // Esto actualiza la tabla de inventario visualmente
            alert("‚úÖ ¬°Venta registrada! El inventario ha sido actualizado.");
        }

        function saveLocal() {
            localStorage.setItem('jaiba_inventory', JSON.stringify(products));
        }
        <footer><p>Solo es un demo de lo que puede pedir</p></footer>
    </script>
</body>
</html>
